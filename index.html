<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Serviço - CBSLeiria</title>
    <link rel="icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        
        .compact-input { height: 2rem; font-size: 0.95rem; }
        .num-input { width: 3.5rem; text-align: center; font-weight: 700; color: #475569; }
        .role-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: #64748b; min-width: 80px; }
        
        input:focus { outline: none; border-color: #dc2626; z-index: 10; }
        .group-header { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; padding: 0.25rem 0.5rem; }

        /* Estilo da lista de sugestões (Autocomplete) */
        .suggestions-box {
            position: absolute;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            z-index: 100;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            top: 100%;
            left: 0;
            font-size: 0.85rem;
            margin-top: 2px;
        }
        .suggestion-item {
            padding: 0.5rem;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            background-color: white;
        }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: #fef2f2; color: #dc2626; }
        
        @media print {
            .no-print, .suggestions-box { display: none !important; }
            body { background-color: white; padding-bottom: 0; }
            input { border: none !important; background: transparent !important; padding-left: 0; }
            .shadow-sm, .shadow-lg { box-shadow: none !important; }
            .bg-slate-100 { background-color: white !important; }
            .bg-red-700 { background-color: #b91c1c !important; color: white !important; }
            .bg-yellow-400 { background-color: #facc15 !important; }
            .bg-slate-700 { background-color: #334155 !important; color: white !important; }
            .role-label { color: #000 !important; }
            main { transform: scale(0.95); transform-origin: top center; }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen text-slate-800 pb-20">

    <div id="export-container" class="bg-slate-100">
        
        <header class="bg-red-700 text-white shadow-sm sticky top-0 z-30 transition-transform">
            <div class="max-w-2xl mx-auto px-3 py-2 flex items-center justify-between gap-2">
                <div class="flex items-center gap-2 flex-shrink-0">
                    
                    <img src="logo.png" alt="Logo" class="h-10 w-auto object-contain">
                    
                    <h1 class="text-xs sm:text-sm font-bold uppercase tracking-wide leading-tight">Escala<br class="block sm:hidden"> Serviço</h1>
                </div>
                
                <div class="flex items-center gap-2">
                     <div id="date-display" class="text-[10px] sm:text-xs font-bold bg-red-800 px-2 py-1 rounded text-white border border-red-600 shadow-inner whitespace-nowrap"></div>
                     
                     <div class="flex gap-1">
                        <button onclick="downloadImage()" class="no-print bg-white/20 hover:bg-white/30 text-white p-1.5 rounded transition-colors" title="Guardar como Imagem">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        </button>
                        <button onclick="window.print()" class="no-print bg-white/20 hover:bg-white/30 text-white p-1.5 rounded transition-colors" title="Imprimir / PDF">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        </button>
                     </div>
                </div>
            </div>
        </header>

        <main class="max-w-2xl mx-auto px-2 py-2 space-y-2">

            <div class="bg-white rounded border-l-4 border-l-yellow-500 border border-slate-300 shadow-sm p-2">
                <div class="flex items-center gap-2">
                    <div class="w-8 flex justify-center"><svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg></div>
                    <div class="flex-grow flex gap-1 relative input-group">
                        <input type="number" id="chefe_servico_num" placeholder="Nº" class="num-input bg-yellow-50 border border-slate-300 rounded compact-input">
                        <div class="relative flex-grow">
                            <input type="text" id="chefe_servico_nome" placeholder="Chefe de Serviço" class="w-full bg-yellow-50 border border-slate-300 rounded px-2 compact-input font-bold text-slate-900" autocomplete="off">
                            </div>
                        <button onclick="clearRow('chefe_servico')" class="no-print px-2 text-slate-300 hover:text-red-600 transition-colors"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg></button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border border-slate-300 shadow-sm">
                <div class="bg-slate-700 text-white rounded-t group-header flex items-center justify-between">
                    <span>CMOS (Comunicações)</span>
                    <svg class="w-3 h-3 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                </div>
                <div class="p-2 space-y-1.5">
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right">Chefe Equipa</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="chefe_cmos_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="chefe_cmos_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('chefe_cmos')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right">Operador</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="operador_cmos_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="operador_cmos_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('operador_cmos')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border border-yellow-400 shadow-sm">
                <div class="bg-yellow-400 text-blue-900 rounded-t group-header flex items-center justify-between">
                    <span>INEM</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                </div>
                <div class="p-2 space-y-1.5">
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-blue-900">Socorrista</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="inem_soc_num" placeholder="Nº" class="num-input bg-yellow-50 border border-yellow-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="inem_soc_nome" class="w-full bg-yellow-50 border border-yellow-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('inem_soc')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-blue-900">Motorista</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="inem_mot_num" placeholder="Nº" class="num-input bg-yellow-50 border border-yellow-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="inem_mot_nome" class="w-full bg-yellow-50 border border-yellow-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('inem_mot')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border border-slate-300 shadow-sm">
                <div class="bg-red-50 text-red-800 rounded-t border-b border-red-100 group-header flex items-center justify-between">
                    <span>1.ª Equipa</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                </div>
                <div class="p-2 space-y-1.5">
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-red-700">Chefe Equipa</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq1_chefe_num" placeholder="Nº" class="num-input bg-red-50 border border-red-100 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq1_chefe_nome" class="w-full bg-red-50 border border-red-100 rounded px-2 compact-input font-semibold" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq1_chefe')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-red-700">Bombeiro 1</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq1_b1_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq1_b1_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq1_b1')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-red-700">Bombeiro 2</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq1_b2_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq1_b2_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq1_b2')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-red-700">Bombeiro 3</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq1_b3_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq1_b3_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq1_b3')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                     <div class="flex items-center gap-2">
                        <span class="role-label text-right text-red-700">Motorista 1</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq1_mot_num" placeholder="Nº" class="num-input bg-slate-100 border border-slate-300 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq1_mot_nome" class="w-full bg-slate-100 border border-slate-300 rounded px-2 compact-input font-medium" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq1_mot')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded border border-slate-300 shadow-sm">
                <div class="bg-slate-100 text-slate-600 rounded-t border-b border-slate-200 group-header flex items-center justify-between">
                    <span>2.ª Equipa</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                </div>
                <div class="p-2 space-y-1.5">
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-slate-600">Bombeiro 4</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq2_b4_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq2_b4_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq2_b4')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="role-label text-right text-slate-600">Bombeiro 5</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq2_b5_num" placeholder="Nº" class="num-input bg-slate-50 border border-slate-200 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq2_b5_nome" class="w-full bg-slate-50 border border-slate-200 rounded px-2 compact-input" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq2_b5')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                     <div class="flex items-center gap-2">
                        <span class="role-label text-right text-slate-600">Motorista 2</span>
                        <div class="flex-grow flex gap-1 relative input-group">
                            <input type="number" id="eq2_mot_num" placeholder="Nº" class="num-input bg-slate-100 border border-slate-300 rounded compact-input">
                            <div class="relative flex-grow">
                                <input type="text" id="eq2_mot_nome" class="w-full bg-slate-100 border border-slate-300 rounded px-2 compact-input font-medium" autocomplete="off">
                            </div>
                            <button onclick="clearRow('eq2_mot')" class="no-print px-1 text-slate-300 hover:text-red-600"><svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded border border-slate-200 p-2 shadow-sm">
                <textarea id="obs_gerais" placeholder="Observações / Reforços..." class="w-full text-xs text-slate-600 border-0 bg-transparent resize-none focus:ring-0 p-1" rows="2"></textarea>
            </div>
<div class="text-center text-[10px] text-slate-600 mt-4 px-4">
            Mesmo fechando o browser, os nomes permanecem na escala quando este for reaberto. <br>
            Só será tudo eliminado quando selecionar "LIMPAR ESCALA" <br>
        </div>

        </main>
    </div> <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-2 shadow-lg z-30 no-print">
        <div class="max-w-2xl mx-auto flex justify-center">
            <button onclick="openModal()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded shadow transition-all active:scale-95 flex items-center justify-center gap-2 text-sm uppercase">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                Limpar Escala
            </button>
        </div>
    </div>

    <div id="confirmModal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden flex items-center justify-center z-50 p-4 opacity-0 transition-opacity duration-300 backdrop-blur-sm no-print">
        <div class="bg-white rounded shadow-2xl max-w-xs w-full p-4 transform scale-95 transition-transform duration-300 border-2 border-red-500" id="modalContent">
            <div class="text-center mb-4">
                 <div class="mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-red-100 mb-2">
                    <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h3 class="text-base font-bold text-gray-900 uppercase">Eliminar tudo?</h3>
                <p class="text-xs text-gray-500">Esta ação não pode ser desfeita.</p>
            </div>
            <div class="flex gap-2">
                <button onclick="closeModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-2 rounded text-xs transition-colors">CANCELAR</button>
                <button onclick="clearAllData()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-2 rounded text-xs transition-colors">ELIMINAR</button>
            </div>
        </div>
    </div>

    <script>
        // Prefix list of all roles
        const rolePrefixes = [
            'chefe_servico', 
            'chefe_cmos', 'operador_cmos',
            'inem_soc', 'inem_mot', 
            'eq1_chefe', 'eq1_b1', 'eq1_b2', 'eq1_b3', 'eq1_mot',
            'eq2_b4', 'eq2_b5', 'eq2_mot'
        ];

        // BASE DE DADOS DE PESSOAL (Importado do CSV)
        const pessoalDB = [
            { n: "4", nome: "JOSÉ MANUEL VALENTE RITO" },
            { n: "5", nome: "DOMINICIANO MARQUES GODINHO" },
            { n: "40", nome: "PAULO JOSÉ GOMES ASCENSO" },
            { n: "14", nome: "ÁLVARO JOSÉ INÁCIO OLIVEIRA" },
            { n: "21", nome: "HELDER PRAGOSA VIEIRA" },
            { n: "25", nome: "LUÍS MIGUEL OLIVEIRA GODINHO" },
            { n: "26", nome: "JOSÉ CARLOS MATOS PRAGOSA" },
            { n: "32", nome: "DAVID ROGÉRIO ROSÁRIO SILVA" },
            { n: "33", nome: "DAVID SAMUEL AGUIAR COELHO" },
            { n: "47", nome: "VASCO ANTÓNIO RIBEIRO SANTOS" },
            { n: "54", nome: "MARCO ANTÓNIO ALMEIDA PEREIRA" },
            { n: "65", nome: "JOÃO ANDRÉ MARTINHO HIPÓLITO" },
            { n: "71", nome: "RUI FILIPE VERÍSSIMO CARVALHO" },
            { n: "73", nome: "GIANLUCA DUARTE SANTO" },
            { n: "75", nome: "EDUARDO SILVA GONÇALVES" },
            { n: "13", nome: "PAULO JORGE N. M.FIGUEIREDO OLIVEIRA" },
            { n: "18", nome: "JOSÉ CARLOS PEREIRA" },
            { n: "23", nome: "EDUARDO J. MONTEIRO BATISTA PINHEIRO" },
            { n: "28", nome: "RICARDO J. RODRIGUES DIAS APARÍCIO" },
            { n: "34", nome: "RUI MIGUEL PEDROSA JOÃO" },
            { n: "36", nome: "JAIME VALA VIEIRA" },
            { n: "42", nome: "SÉRGIO ALEXANDRE RODRIGUES FERREIRA" },
            { n: "52", nome: "JOSÉ CARLOS CORREIA FONSECA" },
            { n: "57", nome: "ANDRÉ FRANCO DOMINGUES" },
            { n: "59", nome: "PEDRO RICARDO MOREIRA FOLGADO" },
            { n: "68", nome: "RICARDO PEREIRA SARAMAGO" },
            { n: "76", nome: "TIAGO ANDRÉ RODRIGUES VIANA CARMO" },
            { n: "16", nome: "NUNO MIGUEL MATOS NARCISO" },
            { n: "20", nome: "ELISEU SOBREIRA RAÍNHO" },
            { n: "24", nome: "NARCISO JESUS FABIÃO" },
            { n: "38", nome: "GONÇALO MIGUEL FERREIRA AMADO" },
            { n: "39", nome: "VITOR MANUEL FILIPE COSTA" },
            { n: "43", nome: "JOSÉ FERNANDO BAPTISTA CARDOSO" },
            { n: "44", nome: "LUÍS CARLOS SIMÕES DIONÍSIO" },
            { n: "51", nome: "PEDRO MIGUEL PATRÍCIO ROSADO" },
            { n: "55", nome: "GONÇALO SILVA ESTEVES" },
            { n: "64", nome: "RAFAEL RODRIGUES OLIVEIRA" },
            { n: "67", nome: "RAFAEL NEVES MARQUES" },
            { n: "70", nome: "ANTÓNIO J. MONTEIRO QUARESMA" },
            { n: "17", nome: "GONÇALO RUI PRAGOSA COSTA" },
            { n: "22", nome: "FREDERICO ANTONIO" },
            { n: "27", nome: "RUI MIGUEL LOPES CARNIDE" },
            { n: "29", nome: "JOÃO PAULO SILVA LOURENÇO" },
            { n: "41", nome: "MARIA CONCEIÇÃO FERREIRA ALVES" },
            { n: "46", nome: "GONÇALO RUI ANTUNES VICENTE" },
            { n: "48", nome: "JOÃO JOSÉ FERREIRA MURRAÇAS" },
            { n: "50", nome: "PAULO JOSÉ SILVA JORGE" },
            { n: "56", nome: "HUGO MANUEL GUERRA AFONSO" },
            { n: "69", nome: "JOSÉ ANTÓNIO BAGAGEM RUIVO" },
            { n: "72", nome: "RUBEN JORGE CLEMENTE" },
            { n: "15", nome: "FILIPE MANUEL NEVES SILVA" },
            { n: "19", nome: "RUI MIGUEL PEREIRA DOMINGUES" },
            { n: "31", nome: "JOÃO PAULO DE ALMEIDA PEREIRA" },
            { n: "35", nome: "NUNO ALEXANDRE COSTA JORDÃO" },
            { n: "37", nome: "DIOGO MIGUEL CRUZ MARECOS" },
            { n: "45", nome: "FERNANDO A. GONÇALVES FERNANDES" },
            { n: "58", nome: "PAULO JORGE SOUSA GODINHO" },
            { n: "61", nome: "VITOR HUGO CAETANO COSTA PEREIRA" },
            { n: "62", nome: "FÁBIO RAFAEL MIRANDA PIRES" },
            { n: "63", nome: "TIAGO MIGUEL SANTOS NARCISO" },
            { n: "66", nome: "DIOGO JOSÉ FERREIRA AMADO" },
            { n: "74", nome: "RITA ISABEL LOPES DOMINGUES" }
        ];

        window.onload = function() {
            // Restore inputs and setup smart search
            rolePrefixes.forEach(prefix => {
                restoreInput(prefix + '_num');
                restoreInput(prefix + '_nome');
                setupSmartSearch(prefix);
            });
            // Restore Obs
            const obs = document.getElementById('obs_gerais');
            if(obs) {
                const saved = localStorage.getItem('bombeiros_app_v4_obs');
                if(saved) obs.value = saved;
                obs.addEventListener('input', (e) => localStorage.setItem('bombeiros_app_v4_obs', e.target.value));
            }

            // --- DATE AUTO-UPDATE LOGIC ---
            function updateDate() {
                const dateOptions = { weekday: 'long', day: 'numeric', month: 'long' };
                const today = new Date().toLocaleDateString('pt-PT', dateOptions);
                const displayElement = document.getElementById('date-display');
                if(displayElement) {
                    displayElement.textContent = today.toUpperCase();
                }
            }

            // Run immediately
            updateDate();

            // Run every 60000ms (1 minute)
            setInterval(updateDate, 60000);
            // ------------------------------

            // Click outside to close suggestions
            document.addEventListener('click', function(e) {
                if(!e.target.closest('.input-group')) {
                    closeAllSuggestions();
                }
            });
        };

        function restoreInput(id) {
            const el = document.getElementById(id);
            if(!el) return;
            
            const savedValue = localStorage.getItem('bombeiros_app_v4_' + id);
            if (savedValue) {
                el.value = savedValue;
            }
            
            el.addEventListener('input', function(e) {
                localStorage.setItem('bombeiros_app_v4_' + id, e.target.value);
            });
        }

        // --- NOVA FUNÇÃO: Configurar pesquisa inteligente (CORRIGIDA COM ORDENAÇÃO) ---
        function setupSmartSearch(prefix) {
            const numInput = document.getElementById(prefix + '_num');
            const nameInput = document.getElementById(prefix + '_nome');
            
            if(!numInput || !nameInput) return;

            // 1. Procurar por Número
            numInput.addEventListener('input', function() {
                const val = this.value.trim();
                const found = pessoalDB.find(p => p.n === val);
                if(found) {
                    nameInput.value = found.nome;
                    // Forçar salvamento no localStorage pois alterámos programaticamente
                    localStorage.setItem('bombeiros_app_v4_' + prefix + '_nome', found.nome);
                }
            });

            // 2. Procurar por Nome (Autocomplete) - COM ORDENAÇÃO POR NÚMERO
            nameInput.addEventListener('input', function() {
                const val = this.value.toLowerCase().trim();
                closeAllSuggestions();
                
                if (!val) return;

                // Filtra pelo nome e ordena pelo número (Crescente)
                const matches = pessoalDB
                    .filter(p => p.nome.toLowerCase().includes(val))
                    .sort((a, b) => parseInt(a.n) - parseInt(b.n));
                
                if (matches.length > 0) {
                    showSuggestions(nameInput, matches, prefix);
                }
            });
        }

        function showSuggestions(inputElement, matches, prefix) {
            const container = inputElement.parentElement; // A div relativa
            
            // Criar caixa de sugestão
            const list = document.createElement('div');
            list.className = 'suggestions-box';
            
            matches.forEach(match => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                // Realçar parte do texto (opcional, aqui simples)
                item.innerHTML = `<span class="font-bold text-red-700">${match.n}</span> - ${match.nome}`;
                
                item.addEventListener('click', function() {
                    // Preencher campos
                    document.getElementById(prefix + '_nome').value = match.nome;
                    document.getElementById(prefix + '_num').value = match.n;
                    
                    // Salvar no Storage
                    localStorage.setItem('bombeiros_app_v4_' + prefix + '_nome', match.nome);
                    localStorage.setItem('bombeiros_app_v4_' + prefix + '_num', match.n);
                    
                    closeAllSuggestions();
                });
                
                list.appendChild(item);
            });
            
            container.appendChild(list);
        }

        function closeAllSuggestions() {
            const lists = document.querySelectorAll('.suggestions-box');
            lists.forEach(l => l.remove());
        }
        // ----------------------------------------------------

        // Clear both Number and Name for a specific row
        function clearRow(prefix) {
            const numId = prefix + '_num';
            const nomeId = prefix + '_nome';
            
            const elNum = document.getElementById(numId);
            const elNome = document.getElementById(nomeId);
            
            if(elNum) {
                elNum.value = '';
                localStorage.removeItem('bombeiros_app_v4_' + numId);
            }
            if(elNome) {
                elNome.value = '';
                localStorage.removeItem('bombeiros_app_v4_' + nomeId);
                elNome.focus();
            }
            closeAllSuggestions();
        }

        // Image Download Function
        function downloadImage() {
            // Find buttons to hide manually
            const noPrintElements = document.querySelectorAll('.no-print');
            noPrintElements.forEach(el => el.style.visibility = 'hidden');

            // Handle Header Stickness for capture
            const header = document.querySelector('header');
            header.classList.remove('sticky', 'top-0');

            const captureElement = document.getElementById('export-container');

            html2canvas(captureElement, {
                scale: 2, 
                backgroundColor: '#f1f5f9' 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'escala_servico_' + new Date().toISOString().split('T')[0] + '.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Restore visibility and sticky
                noPrintElements.forEach(el => el.style.visibility = 'visible');
                header.classList.add('sticky', 'top-0');
            });
        }

        function openModal() {
            const modal = document.getElementById('confirmModal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('confirmModal');
            const content = document.getElementById('modalContent');
            
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function clearAllData() {
            rolePrefixes.forEach(prefix => {
                // Clear DOM
                const elNum = document.getElementById(prefix + '_num');
                const elNome = document.getElementById(prefix + '_nome');
                if(elNum) elNum.value = '';
                if(elNome) elNome.value = '';
                
                // Clear Storage
                localStorage.removeItem('bombeiros_app_v4_' + prefix + '_num');
                localStorage.removeItem('bombeiros_app_v4_' + prefix + '_nome');
            });
            // Clear obs
            document.getElementById('obs_gerais').value = '';
            localStorage.removeItem('bombeiros_app_v4_obs');
            
            closeAllSuggestions();
            closeModal();
        }
    </script>
</body>
</html>